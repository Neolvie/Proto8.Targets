# Technical Documentation

**–í–µ—Ä—Å–∏—è:** 1.0
**–î–∞—Ç–∞:** 2026-02-14
**–°—Ç–∞—Ç—É—Å:** –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ (Developer –¥–æ–ø–æ–ª–Ω–∏—Ç)

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ Python 3.10+ / FastAPI —Å Vanilla JS —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º. –î–µ—Ç–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: `.hypothesis/02_ARCHITECTURE.md`.

–ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- **FastAPI** (–ø–æ—Ä—Ç 8000) ‚Äî —Ä–∞–∑–¥–∞—ë—Ç —Å—Ç–∞—Ç–∏–∫—É –∏ REST API
- **Vanilla JS** ‚Äî —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –±–µ–∑ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤ (index.html, backoffice.html)
- **OpenAI SDK** ‚Äî LLM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–æ streaming
- **SQLite** ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ –æ—Ü–µ–Ω–æ–∫
- **python-docx** ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ DOCX-—Ñ–∞–π–ª–æ–≤

---

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

| –ú–æ–¥—É–ª—å | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|------|----------|
| FastAPI app | `src/main.py` | –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –º–∞—Ä—à—Ä—É—Ç—ã, middleware |
| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | `src/config.py` | –ß—Ç–µ–Ω–∏–µ .env —á–µ—Ä–µ–∑ load_dotenv |
| LLM —Å–µ—Ä–≤–∏—Å | `src/services/llm_service.py` | OpenAI SDK, streaming |
| –ö–µ–π—Å—ã | `src/services/cases_service.py` | 7 OKR-–∫–µ–π—Å–æ–≤ —Å –ø—Ä–æ–º–ø—Ç–∞–º–∏ |
| –ß–∞—Ç | `src/services/chat_service.py` | –°–≤–æ–±–æ–¥–Ω—ã–π —á–∞—Ç |
| JSON –ø–∞—Ä—Å–µ—Ä | `src/services/json_parser.py` | –ü–∞—Ä—Å–∏–Ω–≥ –∫–∞—Ä—Ç—ã —Ü–µ–ª–µ–π Directum Targets |
| DOCX –ø–∞—Ä—Å–µ—Ä | `src/services/docx_parser.py` | –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ Word-–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ |
| –ú–µ—Ç—Ä–∏–∫–∏ | `src/services/metrics_storage.py` | SQLite —Ö—Ä–∞–Ω–∏–ª–∏—â–µ |
| Pydantic –º–æ–¥–µ–ª–∏ | `src/models/` | –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö |
| –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ | `src/static/index.html` | UI: –∑–∞–≥—Ä—É–∑–∫–∞, –∫–µ–π—Å—ã, —á–∞—Ç |
| –ë—ç–∫-–æ—Ñ–∏—Å | `src/static/backoffice.html` | –ú–µ—Ç—Ä–∏–∫–∏ –∏ –≥—Ä–∞—Ñ–∏–∫–∏ |

---

## API Endpoints

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|----------|
| GET | / | –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (index.html) |
| GET | /backoffice | –°—Ç—Ä–∞–Ω–∏—Ü–∞ –º–µ—Ç—Ä–∏–∫ (backoffice.html) |
| GET | /api/health | Healthcheck |
| GET | /api/data/test | –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (Ario.json + Ario.docx) |
| POST | /api/data/upload | –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ |
| POST | /api/cases/{case_id} | –ó–∞–ø—É—Å–∫ –∫–µ–π—Å–∞ 1-7 (SSE streaming) |
| POST | /api/chat | –°–≤–æ–±–æ–¥–Ω—ã–π —á–∞—Ç (SSE streaming) |
| POST | /api/feedback | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏ üëç/üëé |
| GET | /api/metrics | –î–∞–Ω–Ω—ã–µ –¥–ª—è –±—ç–∫-–æ—Ñ–∏—Å–∞ (JSON) |

---

## –î–µ–ø–ª–æ–π

```bash
# –ó–∞–ø—É—Å–∫
docker-compose up

# –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
# –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: http://localhost:8000
# –ë—ç–∫-–æ—Ñ–∏—Å:   http://localhost:8000/backoffice

# –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ —Å –ø–µ—Ä–µ—Å–±–æ—Ä–∫–æ–π –æ–±—Ä–∞–∑–∞
docker-compose up --build
```

---

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|-----------|-------------|----------|--------|
| OPENAI_API_KEY | –î–∞ | API –∫–ª—é—á OpenAI | sk-... |
| OPENAI_MODEL | –î–∞ | –ú–æ–¥–µ–ª—å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ | gpt-4o |
| OPENAI_SERVER | –ù–µ—Ç | –ö–∞—Å—Ç–æ–º–Ω—ã–π endpoint | https://api.openai.com/v1 |

–§–∞–π–ª `.env` –¥–æ–ª–∂–µ–Ω –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞. **–ù–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å** ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π.

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (SQLite)

### –¢–∞–±–ª–∏—Ü–∞ `requests`
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| id | INTEGER PRIMARY KEY | –ê–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç |
| ip | TEXT | IP-–∞–¥—Ä–µ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| endpoint | TEXT | –ü—É—Ç—å –∑–∞–ø—Ä–æ—Å–∞ (/api/cases/1) |
| case_id | INTEGER NULL | ID –∫–µ–π—Å–∞ (1-7) –µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ |
| timestamp | DATETIME | –í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞ |

### –¢–∞–±–ª–∏—Ü–∞ `feedback`
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| id | INTEGER PRIMARY KEY | –ê–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç |
| ip | TEXT | IP-–∞–¥—Ä–µ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| case_id | INTEGER | ID –∫–µ–π—Å–∞ (1-7) |
| session_id | TEXT | ID —Å–µ—Å—Å–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞ |
| vote | INTEGER | 1 (üëç) –∏–ª–∏ -1 (üëé) |
| timestamp | DATETIME | –í—Ä–µ–º—è –æ—Ü–µ–Ω–∫–∏ |

---

## –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# Unit –∏ integration —Ç–µ—Å—Ç—ã
pytest --cov=src tests/ -v

# –° –æ—Ç—á—ë—Ç–æ–º –æ –ø–æ–∫—Ä—ã—Ç–∏–∏
pytest --cov=src --cov-report=term-missing tests/

# –¢–æ–ª—å–∫–æ E2E (—Ç—Ä–µ–±—É–µ—Ç –∑–∞–ø—É—â–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
pytest tests/e2e/ -v
```

---

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞

- –ù–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Directum Targets API (—Ç–æ–ª—å–∫–æ –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤)
- –ù–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- –ù–µ—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ —Å–µ—Å—Å–∏–π –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞–º–∏
- –¢–æ–ª—å–∫–æ —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫–∞—Ä—Ç—ã —Ü–µ–ª–µ–π –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –º–æ–¥–µ–ª–∏ (~128K —Ç–æ–∫–µ–Ω–æ–≤)
- –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤ (–±–µ–∑ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á)
- SQLite –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ (–ø—Ä–æ—Ç–æ—Ç–∏–ø, –Ω–µ production)
