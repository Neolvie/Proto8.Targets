<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Directum Targets AI Assistant v2</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="app-layout">
    <!-- Left Panel -->
    <aside class="left-panel">
      <div class="panel-header">
        <h2>Контекст</h2>
      </div>

      <!-- Period Filter -->
      <div class="panel-section">
        <label for="period-filter" class="filter-label">Период:</label>
        <select id="period-filter" class="period-select" onchange="filterMapsByPeriod()">
          <option value="">— все периоды —</option>
        </select>
      </div>

      <!-- Maps Dropdown -->
      <div class="panel-section">
        <label for="maps-select" class="filter-label">Карта целей:</label>
        <select id="maps-select" class="period-select" onchange="onMapSelectChange()">
          <option value="">— выберите карту —</option>
        </select>
      </div>

      <!-- Goals List (shown after map selected) -->
      <div id="goals-section" class="panel-section goals-section-expandable hidden">
        <label class="filter-label">Цель (опционально):</label>
        <div id="goals-list" class="goals-list">
          <!-- Populated dynamically -->
        </div>
      </div>

      <!-- Selected Context Indicator -->
      <div class="context-indicator" id="context-indicator">
        <div class="context-label">Выбрано:</div>
        <div id="context-text" class="context-text">— нет выбора —</div>
      </div>
    </aside>

    <!-- Main Area -->
    <main class="main-area">
      <header class="app-header">
        <div class="header-left">
          <span class="header-logo">Directum Targets</span>
          <span class="header-subtitle">ИИ-помощник v2</span>
        </div>
        <nav class="header-nav">
          <a href="/backoffice" target="_blank">Бэк-офис</a>
        </nav>
      </header>

      <!-- Chat -->
      <div class="chat-container">
        <div class="chat-messages" id="chat-messages">
          <div class="chat-message assistant">
            Здравствуйте! Выберите карту или цель слева, затем задайте вопрос или нажмите кнопку кейса.
          </div>
        </div>

        <!-- Case Buttons -->
        <div class="case-buttons-bar" id="case-buttons-bar">
          <button class="case-btn" data-case-id="1" data-mode="target" onclick="runCaseInChat(1)" disabled title="Проверка на SMART-критерии и генерация улучшенных вариантов">Формулировка цели</button>
          <button class="case-btn" data-case-id="2" data-mode="target" onclick="runCaseInChat(2)" disabled title="Генерация 3-4 наборов измеримых KR">Ключевые результаты</button>
          <button class="case-btn" data-case-id="3" data-mode="target" onclick="runCaseInChat(3)" disabled title="Разбивка годовой цели на квартальные подцели">Декомпозиция</button>
          <button class="case-btn" data-case-id="4" data-mode="target" onclick="runCaseInChat(4)" disabled title="Проверка соответствия ожиданиям руководства">Верификация</button>
          <button class="case-btn" data-case-id="5" data-mode="map" onclick="runCaseInChat(5)" disabled title="Анализ карты целей на противоречия и пробелы">Конфликты карты</button>
          <button class="case-btn" data-case-id="6" data-mode="target" onclick="runCaseInChat(6)" disabled title="Анализ прогресса и матрица рисков">Риски</button>
          <button class="case-btn" data-case-id="7" data-mode="map" onclick="runCaseInChat(7)" disabled title="Топ цели с наибольшим отставанием">Экспресс-отчёт</button>
        </div>

        <!-- Input Area -->
        <div class="chat-input-area">
          <textarea
            class="chat-input"
            id="chat-input"
            placeholder="Введите вопрос... (Enter для отправки, Shift+Enter — перенос строки)"
            rows="1"
            onkeydown="handleChatKeydown(event)"
            oninput="autoResizeTextarea(this)"
          ></textarea>
          <button class="btn btn-primary" onclick="sendChatMessage()" id="btn-chat-send">Отправить</button>
          <button class="btn btn-secondary" onclick="resetConversation()" title="Сбросить историю диалога">Новая беседа</button>
        </div>
      </div>
    </main>
  </div>

  <script src="/static/app.js"></script>
</body>
</html>
